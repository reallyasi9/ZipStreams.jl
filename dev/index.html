<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Overview · ZipStreams</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>ZipStreams</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Overview</a><ul class="internal"><li><a class="tocitem" href="#Synopsis"><span>Synopsis</span></a></li><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#DO-NOT-BLINDLY-TRUST-ZIP-ARCHIVES"><span>DO NOT BLINDLY TRUST ZIP ARCHIVES</span></a></li><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Terminology:-Archives-and-Files,-Sources-and-Sinks"><span>Terminology: Archives and Files, Sources and Sinks</span></a></li><li><a class="tocitem" href="#Notes"><span>Notes</span></a></li></ul></li><li><a class="tocitem" href="sources/">Reading from Sources</a></li><li><a class="tocitem" href="sinks/">Writing to Sinks</a></li><li><a class="tocitem" href="info/">Printing Information</a></li><li><a class="tocitem" href="misc/">Other Operations</a></li><li><a class="tocitem" href="pathological/">Pathological Files</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Overview</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Overview</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/reallyasi9/ZipStreams.jl/blob/main/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="ZipStreams"><a class="docs-heading-anchor" href="#ZipStreams">ZipStreams</a><a id="ZipStreams-1"></a><a class="docs-heading-anchor-permalink" href="#ZipStreams" title="Permalink"></a></h1><p>A Julia package to read and write ZIP archives from read-only or write-only streams by ignoring standards just a little bit.</p><h2 id="Synopsis"><a class="docs-heading-anchor" href="#Synopsis">Synopsis</a><a id="Synopsis-1"></a><a class="docs-heading-anchor-permalink" href="#Synopsis" title="Permalink"></a></h2><pre><code class="language-julia hljs">using ZipStreams

zipsink(&quot;archive.zip&quot;) do sink     # context management of sinks with &quot;do&quot; syntax
    open(sink, &quot;hello.txt&quot;) do f   # context management of files with &quot;do&quot; syntax
        write(f, &quot;Hello, Julia!&quot;)  # write just like you write to any IO object
    end
end

zipsource(&quot;archive.zip&quot;) do source   # context management of sources with &quot;do&quot; syntax
    for f in source                  # iterate through files in an archive
        println(f.info.name)         # &quot;hello.txt&quot;
        read_data = read(String, f)  # read just like you read from any IO object
        println(read_data)           # &quot;Hello, Julia!&quot;
    end
end</code></pre><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><blockquote><p>&quot;There are three ways to do things: the right way, the wrong way, and the Max Power way.&quot;</p><p>-Homer from The Simpsons, season 10, episode 13: &quot;Homer to the Max&quot;</p></blockquote><p>ZIP archives are optimized for <em>appending</em> and <em>deleting</em> operations. This is because the canonical source of information for what is stored in a ZIP archive, the &quot;Central Directory&quot;, is written at the very end of the archive. Users who want to append a file to the archive can overwrite the Central Directory with new file data, then append an updated Central Directory afterward, and nothing else in the file has to be touched. Likewise, users who want to delete files in the archive only have to change the entries in the Central Directory: readers that conform to the standard described in the <a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT">PKWARE APPNOTE file</a> will ignore the files that are no longer listed.</p><p>This design choice means that standards-conformant readers like <a href="https://github.com/fhs/ZipFile.jl"><code>ZipFile.jl</code></a> cannot know what files are stored in a ZIP archive until they read to the very end of the archive. While this is not typically a problem on modern SSD-based storage, where random file access is fast, it is a major limitation on stream-based file transfer systems like networks, where readers typically have no choice but to read an entire file from beginning to end in order. And again, this is not a problem for archives with sizes on the order of megabytes, but standard ZIP archives can be as large as 4GB, which can easily overwhelm systems with limited memory or storage like embedded systems or cloud-based micro-instances. To make matters worse, ZIP64 archives can be up to 16 EB (2^64 bytes) in size, which can easily overwhelm even the largest of modern supercomputers.</p><p>However, the ZIP archive specification also requires a &quot;Local File Header&quot; to precede the (possibly compressed) file data of every file in the archive. The Local File Header contains enough information to allow a reader to extract the file and perform simple error checking as long as three conditions are met:</p><ol><li>The information in the Local File Header is correctly specified. The Central Directory is the canonical source of information, so the Local File Header could be lying.</li><li>The Central Directory is not encrypted. File sizes and checksum values are masked from the Local File Header if the Central Directory is encrypted, so it is impossible to know where the file ends and the next one begins.</li><li>The file is not stored with a &quot;Data Descriptor&quot; (general purpose flag 3). As with encryption, files that are stored with a Data Descriptor have masked file sizes and checksums in the Local File Header. This format is typically used only when the archive is <em>written</em> in a streaming fashion.</li></ol><p>All this being said, most users will never see ZIP files that cannot be extracted exclusively using Local File Header information.</p><h3 id="About-files-written-with-Data-Descriptors"><a class="docs-heading-anchor" href="#About-files-written-with-Data-Descriptors">About files written with Data Descriptors</a><a id="About-files-written-with-Data-Descriptors-1"></a><a class="docs-heading-anchor-permalink" href="#About-files-written-with-Data-Descriptors" title="Permalink"></a></h3><p>When a file is streamed to an archive, the final size of the file may not be knowable until the last byte is written–this is especially true if the file is being compressed while it is being streamed. Files streamed in this way use a Data Descriptor, appended immediately after the file data, to record the CRC-32 checksum and compressed and uncompressed sizes. Files <em>written</em> in this way can be <em>read</em> in a streaming way as well, but only if the data being read is buffered, and only if the file was written with the optional Data Descriptor signature as described in section 4.3.9.3 of the <a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT">PKWARE APPNOTE file</a>.</p><p>When reading a file that signals in the Local File Header that it uses a Data Descriptor, this package will check for a valid Data Descriptor on <em>every read</em> from the stream. This is the only way the package can determine if a file written with a Data Descriptor has been completely consumed from the archive source. This makes reading files using Data Descriptors much less efficient than reading files that use Local File Headers to specify lengths, where the package only has to count bytes to know if it has completely consumed the file from the archive source.</p><h2 id="DO-NOT-BLINDLY-TRUST-ZIP-ARCHIVES"><a class="docs-heading-anchor" href="#DO-NOT-BLINDLY-TRUST-ZIP-ARCHIVES">DO NOT BLINDLY TRUST ZIP ARCHIVES</a><a id="DO-NOT-BLINDLY-TRUST-ZIP-ARCHIVES-1"></a><a class="docs-heading-anchor-permalink" href="#DO-NOT-BLINDLY-TRUST-ZIP-ARCHIVES" title="Permalink"></a></h2><p>By ignoring the Central Directory, this module makes no guarantees that what you get out of the ZIP archive matches what you or anyone else put into it. The code is tested against ZIP archives generated by various writers, but there are corner cases, ambiguities in the standard, and even pathological ZIP files in the wild that may silently break this package.</p><blockquote><p><em>Bart:</em> &quot;Isn&#39;t that the wrong way?&quot;</p><p><em>Homer:</em> &quot;Yeah, but faster!&quot;</p><p>-The Simpsons, season 10, episode 13: &quot;Homer to the Max&quot;</p></blockquote><p>You have been warned!</p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>Install via the Julia package manager, <code>Pkg.add(&quot;ZipStreams&quot;)</code>.</p><h2 id="Terminology:-Archives-and-Files,-Sources-and-Sinks"><a class="docs-heading-anchor" href="#Terminology:-Archives-and-Files,-Sources-and-Sinks">Terminology: Archives and Files, Sources and Sinks</a><a id="Terminology:-Archives-and-Files,-Sources-and-Sinks-1"></a><a class="docs-heading-anchor-permalink" href="#Terminology:-Archives-and-Files,-Sources-and-Sinks" title="Permalink"></a></h2><p>To avoid ambiguity, this package tries to use the following terms consistently throughout type names, function names, and documentation:</p><ul><li><p><strong>File</strong>: A File is a named sequence of zero or more bytes that represents a distinct collection of data within an Archive. According to the ZIP standard, a File is always preceded by a Local File Header and may have a Data Descriptor following the File&#39;s contents. The contents of the File may be compressed within the Archive.</p></li><li><p><strong>Directory</strong>: A Directory is a named structure within an Archive that exists for organizational purposes only. A Directory meets the definition of File with the additional conditions that it always has size zero, it never has a Data Descriptor following it, and has a name that always ends in a forward slash character (<code>/</code>).</p></li><li><p><strong>Entity</strong>: An Entity is either a File or a Directory.</p></li><li><p><strong>Archive</strong>: An Archive is a sequence of bytes that represents zero or more separate Entities. According to the ZIP standard, an Archive is a series of Entities followed by a Central Directory which describes the Entities.</p></li><li><p><strong>Source</strong>: A Source is an object that can be read as a sequence of bytes from beginning to end. A Source does not necessarily implement random access or seek operations, nor does it necessarily support write operations.</p></li><li><p><strong>Sink</strong>: A Sink is an object to which a sequence of bytes can be written. A Sink does not necessarily implement random access or seek operations, nor does it necessarily support read operations.</p></li></ul><h2 id="Notes"><a class="docs-heading-anchor" href="#Notes">Notes</a><a id="Notes-1"></a><a class="docs-heading-anchor-permalink" href="#Notes" title="Permalink"></a></h2><p>This package was inspired by frustrations with using standards-compliant ZIP archive reader/writers like <a href="https://github.com/fhs/ZipFile.jl"><code>ZipFile.jl</code></a> on streams of data from a network source. That&#39;s not to say ZipFile.jl is bad–on the contrary, it is <em>way</em> more standards-compliant than this package ever intends to be! As you can see from the history of this repository, much of the work here started as a fork of that package. Because of that, I am grateful to <a href="https://github.com/fhs">Fazlul Shahriar</a> for programming and making available <code>ZipFile.jl</code>.</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="sources/">Reading from Sources »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 15 April 2024 20:14">Monday 15 April 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
